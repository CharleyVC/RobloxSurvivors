-- ReplicatedStorage/Combat/Modifiers/Invulnerability.lua

local RunService = game:GetService("RunService")
local ActionPhases = require(game.ReplicatedStorage.Combat.ActionPhases)

local Invulnerability = {
	Id = "Invulnerability",
	Phases = {
		ActionPhases.OnActionStart,
		ActionPhases.OnExpire,
	},
	Priority = 99,
	AppliesTo = "All", -- ðŸ”‘ generic
	RequiredTags = "Invulnerable"
}

if RunService:IsServer() then
	local EffectsAuthority =
		require(game.ServerScriptService.Scripts.EffectsAuthority)

	function Invulnerability.Execute(context)
		local actor = context.Actor
		if not actor then return end

		--local invuln = context.Invulnerability
		--if not invuln or not invuln.Enabled then return end

		if context.Phase == ActionPhases.OnActionStart then
			EffectsAuthority.applyInvulnerability(actor, true)
		elseif context.Phase == ActionPhases.OnExpire then
			EffectsAuthority.applyInvulnerability(actor, false)
		end
	end
end

return Invulnerability
